<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro VIP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="min-h-screen flex items-center justify-center bg-black px-4">

<div class="w-full max-w-md rounded-2xl border border-gray-800 bg-gray-900 p-8 shadow-2xl">

  <div class="mb-6 text-center">
    <div class="mx-auto mb-3 flex h-16 w-16 items-center justify-center rounded-full bg-yellow-400/20">
      <i data-lucide="crown" class="h-8 w-8 text-yellow-400"></i>
    </div>
    <h1 class="text-3xl font-bold text-yellow-400">Registro VIP</h1>
    <p class="mt-1 text-sm text-gray-400">Acceso premium exclusivo</p>
  </div>

  <form id="registerForm" class="space-y-4">

    <div>
      <label class="text-sm text-gray-300">Correo electrónico</label>
      <div class="relative mt-1">
        <i data-lucide="mail" class="absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"></i>
        <input id="email" type="email" required
          class="w-full rounded-xl border border-gray-700 bg-gray-800 py-2 pl-10 pr-4 text-white focus:ring-2 focus:ring-yellow-400 outline-none"
          placeholder="correo@ejemplo.com">
      </div>
    </div>

    <div>
      <label class="text-sm text-gray-300">Contraseña</label>
      <div class="relative mt-1">
        <i data-lucide="lock" class="absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"></i>
        <input id="password" type="password" required
          class="w-full rounded-xl border border-gray-700 bg-gray-800 py-2 pl-10 pr-4 text-white focus:ring-2 focus:ring-yellow-400 outline-none"
          placeholder="••••••••">
      </div>
    </div>

    <div>
      <label class="text-sm text-gray-300">Plan VIP</label>
      <div class="relative mt-1">
        <i data-lucide="star" class="absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"></i>
        <select id="plan"
          class="w-full rounded-xl border border-gray-700 bg-gray-800 py-2 pl-10 pr-4 text-white focus:ring-2 focus:ring-yellow-400 outline-none">
          <option value="mensual" data-price="9.99">VIP Mensual</option>
          <option value="trimestral" data-price="24.99">VIP Trimestral</option>
          <option value="anual" data-price="79.99">VIP Anual ⭐</option>
        </select>
      </div>
    </div>

    <div class="rounded-xl bg-gray-800 p-3 text-center">
      <p class="text-sm text-gray-400">Precio del plan</p>
      <p id="price" class="text-2xl font-bold text-yellow-400">$9.99 USD</p>
    </div>

    <button id="submitBtn"
      class="flex w-full items-center justify-center gap-2 rounded-xl bg-yellow-400 py-3 text-lg font-bold text-black transition hover:bg-yellow-300">
      <i data-lucide="zap" class="h-5 w-5"></i>
      <span id="btnText">Crear cuenta VIP</span>
    </button>

  </form>

  <p id="msg" class="mt-4 text-center text-sm"></p>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBztO843Y-ziCqIXnFnsgyGEiVVgLR2QnA",
    authDomain: "log-flixpe-vide.firebaseapp.com",
    projectId: "log-flixpe-vide",
    storageBucket: "log-flixpe-vide.firebasestorage.app",
    messagingSenderId: "523403789416",
    appId: "1:523403789416:web:60c3abd4148d9c5de7a7dd"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const form = document.getElementById("registerForm");
  const plan = document.getElementById("plan");
  const priceText = document.getElementById("price");
  const btn = document.getElementById("submitBtn");
  const btnText = document.getElementById("btnText");
  const msg = document.getElementById("msg");

  plan.addEventListener("change", () => {
    const price = plan.selectedOptions[0].dataset.price;
    priceText.textContent = `$${price} USD`;
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    btn.disabled = true;
    btn.classList.add("opacity-70", "cursor-not-allowed");
    btnText.textContent = "Creando cuenta...";
    msg.textContent = "";

    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    const planValue = plan.value;

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const uid = userCredential.user.uid;

      await setDoc(doc(db, "usuarios", uid), {
        email,
        estado: "pendiente",
        plan: planValue,
        diasVIP: 0,
        vencimiento: null,
        createdAt: new Date().toISOString()
      });

      msg.textContent = "✅ Registro exitoso, redirigiendo...";
      msg.className = "mt-4 text-center text-green-400";

      setTimeout(() => {
        location.href = "espera.html";
      }, 1500);

    } catch (error) {
      msg.textContent = "❌ " + error.message;
      msg.className = "mt-4 text-center text-red-400";
      btn.disabled = false;
      btn.classList.remove("opacity-70", "cursor-not-allowed");
      btnText.textContent = "Crear cuenta VIP";
    }
  });
</script>

<script>lucide.createIcons();</script>
</body>
  </html>
